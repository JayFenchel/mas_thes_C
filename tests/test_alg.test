/*DO 
  checkmk tests/test_alg.test >tests/test_alg.c
*/
#include "../include/hhmpcalg.h"
#include "../include/hhmpcmath.h"
#include "../include/hhmpcusefull.h"

#define N 2
#define M 1
#define T 2

#test form_Y_test
    real_t A[] = {1., 2., 1., 2.};
    real_t B[] = {-3., 1.};    
    real_t Y[T*N*T*N] = {0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.};
    real_t Phi[] = {4., 0., 0., 0., 0., 0.,
                    0., 5., 2., 0., 0., 0.,
                    0., 2., 4., -1., 0., 0.,
                    0., 0., -1., 2., 0., 0.,
                    0., 0., 0., 0., 4., -3.,
                    0., 0., 0., 0., -3., 4.};
    real_t Y_ref[] = {271./108., -97/108., -5./27., 1./9., -97/108., 67/108., -1./27., -7./9., -5./27., -1./27., 997./189., -50./63., 1./9., -7./9., -50./63, 61./21.};
   
    form_Y(Y, Phi, T, A, N, B, M);
    print_mtx(Y_ref, 4, 4);
    print_mtx(Y, T*N, T*N);
    
    fail_unless(mtx_cmp(Y, Y_ref, 16, 1e-8) == 0, "form_Y failed");
    
#test form_Y11_test
    real_t sol[N*N];
    real_t B[] = {-3., 1.};
    real_t R0_I[] = {-.5};
    real_t Q1[] = {1., 0., 0., 1.};
    
    real_t sol_ref[] = {37., -12., -12., 5.};
    form_Y11(sol, B, N, M, R0_I, Q1);
    fail_unless(mtx_cmp(sol, sol_ref, 4, 0) == 0, "form_Y11 failed");

#test setBlock_test
    real_t Phi[] = {1., 0., 0., 0., 0., 0.,
                    0., 2., 2., -2., 0., 0.,
                    0., 2., -2., 2., 0., 0.,
                    0., -2., 2., 2., 0., 0.,
                    0., 0., 0., 0., 3., -3.,
                    0., 0., 0., 0., -3., 3.};
    uint32_t dim = 6;
    real_t block[] = {1., 1., 0., 0., 1., 1., 0., 1., 0., 0., 0., 0.};
    real_t Phi_ref[] = {1., 0., 0., 0., 0., 0.,
                    0., 2., 2., -2., 0., 0.,
                    0., 2., -2., 1., 1., 0.,
                    0., -2., 2., 0., 1., 1.,
                    0., 0., 0., 0., 1., 0.,
                    0., 0., 0., 0., 0., 0.};

    setBlock(Phi, dim, block, 3, 4, 2, 3);
    fail_unless(mtx_cmp(Phi, Phi_ref, 36, 0) == 0, "setBlock failed");

#test getBlock_test
    real_t Phi[] = {1., 0., 0., 0., 0., 0.,
                    0., 2., 2., -2., 0., 0.,
                    0., 2., -2., 2., 0., 0.,
                    0., -2., 2., 2., 0., 0.,
                    0., 0., 0., 0., 3., -3.,
                    0., 0., 0., 0., -3., 3.};
    uint32_t dim = 6;
    real_t block[12];
    real_t block_ref[] = {2., 0., 0., 2., 0., 0., 0., 3., -3., 0., -3., 3.};
    uint32_t first_row = 2, first_col = 3, size_row = 3, size_col = 4;
    getBlock(block, Phi, dim, first_row, first_col, size_row, size_col);
    fail_unless(mtx_cmp(block, block_ref, 12, 0) == 0, "getBlock failed");
    
    